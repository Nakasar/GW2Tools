<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <meta name="theme-color" content="#000000">
  <meta name="description" content="">
  <meta name="author" content="Kevin 'Nakasar' Thizy">

  <title>Cartographe - Outils RP</title>

  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.1/dist/leaflet.css" />
  <link rel="stylesheet" href="style.css">

</head>
<body>
  <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Afficher le menu</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="http://gw2rp-tools.ovh">Outils RP</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li><a href="#" data-toggle="collapse" data-target=".navbar-collapse.in" id="about-btn"><span class="glyphicon glyphicon-question-sign"></span> A Propos</a></li>
            <li class="active"><a href="#"><span class="glyphicon glyphicon-globe"></span> Cartographe</a></li>
            <li><a href="#" data-toggle="collapse" data-target=".navbar-collapse.in" id="login-btn"><span class="glyphicon glyphicon-user"></span> <span id="login-btn-text">Se connecter</span></a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
  </nav>

  <div id="container">
    <div id="sidebar">
      <div class="sidebar-wrapper">
        <div id="features" class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">Détails</h3>
          </div>
          <ul class="list-group">
              <li class="list-group-item">
                <h4 class="list-group-item-heading">Type</h4>
                <p class="list-group-item-text type">Ipsum</p>
              </li>
              <li class="list-group-item">
                <h4 class="list-group-item-heading" id="hours-heading">Horaires</h4>
                <p class="list-group-item-text hours">Ipsum</p>
              </li>
              <li class="list-group-item">
                <h4 class="list-group-item-heading">Contact</h4>
                <p class="list-group-item-text contact">Ipsum</p>
              </li>
              <li class="list-group-item">
                <a target="_blank" href="#" class="list-group-item list-group-item-info site"></a>
              </li>
              <li class="list-group-item">
                <h4 class="list-group-item-heading">Description</h4>
                <p class="list-group-item-text description">Ipsum</p>
                <a href="#" data-toggle="modal" data-target="#permloc-detail-modal">
                  + Suite ...
                </a>
              </li>
              <li class="list-group-item list-group-item-warning">
                <h4 class="list-group-item-heading">Actions</h4>
                <button type="button" class="btn btn-danger" onclick="actionDelete();" id="actionDelete">Supprimer</button>
                <button type="button" class="btn btn-warning" onclick="actionModify();" id="actionModify">Modifier</button>
              </li>
          </ul>
        </div>
      </div>
    </div>
    <div id="mapdiv"></div>
  </div><!-- /.container -->

  <div class="modal fade" id="aboutModal" tabindex="-1" role="dialog">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <button class="close" type="button" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 class="modal-title">Bienvenue sur la boîte à outils rôleplay pour Guild Wars 2 !</h4>
          </div>
          <div class="modal-body">
            <ul class="nav nav-tabs nav-justified" id="aboutTabs">
              <li class="active"><a href="#about" data-toggle="tab"><i class="fa fa-question-circle"></i>&nbsp;A propos des outils</a></li>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-globe"></i>&nbsp;Utilisation <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li><a href="#tuto-cartopgraphe-tab" data-toggle="tab">Cartographe</a></li>
                </ul>
              </li>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-globe"></i>&nbsp;Sources <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li><a href="#donnees-tab" data-toggle="tab">Cartes & marqueurs</a></li>
                  <li><a href="#locations-tab" data-toggle="tab">Lieux RP</a></li>
                  <li><a href="#theaters-tab" data-toggle="tab">Events</a></li>
                </ul>
              </li>
            </ul>
            <div class="tab-content" id="aboutTabsContent">
              <div class="tab-pane fade active in" id="about">
                <p>Un ensemble d'outils conçus pour Guild Wars 2 et la pratique du jeu de rôle. L'application utilise Bootstrap pour la mise en page et Leaflet pour la gestion de la carte.
                <br>
                Réalisé par Kevin <em>"Nakasar"</em> Thizy (Nakasar.5192). <em>Pour tout commentaire, signalement de bug, je préfère un MP forum GW2RP ou un MP en jeu ;)</em></p>
                <div class="panel panel-primary">
                  <div class="panel-heading">C'est quoi donc ?</div>
                  <ul class="list-group">
                    <li class="list-group-item">
                      <h4 class="list-group-item-heading">Le Cartographe</h4>
                      <p class="list-group-item-text">Recense les lieux de RP réguliers et les énèments en cours.</p>
                    </li>
                    <li class="list-group-item">
                      <h4 class="list-group-item-heading">Rien</h4>
                      <p class="list-group-item-text">Si j'ai envie de rajouter un outil, il ira ici, chouette, non ?</p>
                    </li>
                  </ul>
                </div>
              </div>
              <div class="tab-pane fade" id="donnees-tab">
                <p>Les images, icône, et coordonnées sont la propriété d'ArenaNet pour le jeu Guild Wars 2.</p>
              </div>
              <div class="tab-pane fade" id="locations-tab">
                <p>Les lieux sont indiqués en fonction des activités RôlePlay des joueurs de la communauté.</p>
              </div>
              <div class="tab-pane fade" id="theaters-tab">
                <p>Les events sont des lieux temporaires. Affichés pour une durée maximale de une semaine, ils signalent une activité particulière dans un lieu.</p>
              </div>
              <div class="tab-pane fade" id="tuto-cartopgraphe-tab">
                  <ul class="list-group">
                    <li class="list-group-item">Vous devez être connecté pour ajouter des marqueurs.</li>
                    <li class="list-group-item">Cliquez droit sur la carte pour ajouter un nouveau marqueur à cet emplacement.</li>
                    <li class="list-group-item">Cliquez gauche sur un marqueur de la carte pour afficher des détails à son sujet.</li>
                    <li class="list-group-item">Après avoir sélectionné un marquer, utilisez le menu latéral gauche pour le supprimer ou le modifier.</li>
                    <li class="list-group-item">Utilisez le panneau "Mon Compte" pour vous déconnecter.</li>
                  </ul>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Fermer</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <div class="modal fade" id="loginModal" tabindex="-1" role="dialog">
      <div class="modal-dialog modal-sm">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 class="modal-title">Connexion</h4>
          </div>
          <div class="modal-body">
            <form id="contact-form">
              <div class="alert alert-success alert-dismissible" role="alert" id="signUp-Success">
                Votre compte a été créé. Veuillez vous identifier.
                <button type="button" class="close" data-dismiss="alert" aria-label="Fermer">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <fieldset>
                <div class="form-group">
                  <label for="username">Nom d'utilisateur:</label>
                  <input type="text" class="form-control" id="username" placeholder="Entrez un nom d'utilisater">
                </div>
                <div class="form-group">
                  <label for="password">Mort de passe :</label>
                  <input type="password" class="form-control" id="password" placeholder="Mot de passe">
                </div>
              </fieldset>
              <div class="alert alert-danger alert-dismissible" role="alert" id="signinalert">
                Le nom d'utilisateur et le mot de passe ne correspondent pas.
                <button type="button" class="close" data-dismiss="alert" aria-label="Fermer">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <button type="button" class="btn btn-primary" onClick="signIn();">Connexion</button>
              <button type="button" class="btn btn-success" data-toggle="modal" data-target="#signUp-Modal">S'enregistrer</button>
            </form>
            <button type="button" class="btn btn-danger" onclick="signOut();" id="disconnect">Se déconnecter</button>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-primary" data-dismiss="modal">Fermer</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <div class="modal fade" id="signUp-Modal" tabindex="-1" role="dialog">
      <div class="modal-dialog modal-sm">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 class="modal-title">Enregistrement</h4>
          </div>
          <div class="modal-body">
            <form id="signup-form">
              <fieldset>
                <div class="form-group">
                  <label for="signup-username">Nom d'utilisateur :</label>
                  <input type="text" class="form-control" id="signup-username" aria-describedby="signup-username-Help">
                  <small id="signup-username-Help" class="form-text text-muted">Nom affiché publiquement.</small>
                </div>
                <div class="form-group">
                  <label for="signup-email">Email :</label>
                  <input type="email" class="form-control" id="signup-email" aria-describedby="signup-email-Help">
                  <small id="signup-email-Help" class="form-text text-muted">Votre adresse ne sera pas affichée.</small>
                </div>
                <div class="form-group">
                  <label for="signup-password">Mot de passe :</label>
                  <input type="password" class="form-control" id="signup-password">
                </div>
                <div class="form-group">
                  <label for="signup-password-confirm">Confirmation :</label>
                  <input type="password" class="form-control" id="signup-password-confirm">
                </div>
              </fieldset>
              <fieldset>
                <div class="form-group">
                  <label for="signup-gw2account">Nom de compte GW2 (Nakasar.5192) :</label>
                  <input type="text" class="form-control" id="signup-gw2account" aria-describedby="signup-gw2account-help">
                  <small id="signup-gw2account-help" class="form-text text-muted">Votre nom de compte est affiché en haut de la liste de contact.</small>
                </div>
              </fieldset>
              <div class="alert alert-danger alert-dismissible" role="alert" id="signUp-Alert">
                Vous devez valider l'ensemble des champs.
                <button type="button" class="close" data-dismiss="alert" aria-label="Fermer">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <button type="button" class="btn btn-success" onClick="signUp();">S'enregistrer</button>
            </form>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-primary" data-dismiss="modal">Fermer</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <div class="modal fade" id="addMarkerModal" tabindex="-1" role="dialog">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <button class="close" type="button" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 class="modal-title">Ajout d'un marqueur.</h4>
          </div>
          <div class="modal-body">
            <ul class="nav nav-tabs nav-justified" id="addLocationTabs">
              <li class="nav-link active">
                <a href="#addPermanentLocationTabContent" id="addPermanentLocationTab" data-toggle="tab"><i class="fa fa-question-circle"></i>&nbsp;Lieu permanent</a>
              </li>
              <li class="nav-link">
                <a href="#addEventLocationTabContent" id="addEventLocationTab" data-toggle="tab"><i class="fa fa-envelope"></i>&nbsp;Evènement</a>
              </li>
              <li class="nav-link">
                <a href="#addRumourTabContent" id="addRumourTab" data-toggle="tab"><i class="fa fa-envelope"></i>&nbsp;Rumeur</a>
              </li>
            </ul>
          </div>
          <div class="tab-content" id="addLocationTabsContent">
            <div class="tab-pane fade active in" id="addPermanentLocationTabContent">
              <form id="perm-form">
                <div class="well well-sm">
                  <div class="row">
                    <div class="col-md-4">
                      <div class="form-group">
                        <label for="name">Nom</label>
                        <input type="text" class="form-control" id="name" placeholder="Le Pacte des Oubliés">
                      </div>
                      <div class="form-group">
                        <label for="type">Type</label>
                        <select multiple class="form-control" id="type">
                          <option value="tavern">Taverne</option>
                          <option value="trading">Commerce</option>
                          <option value="exploration">Exploration</option>
                          <option value="mercenary">Mercenariat</option>
                          <option value="research">Recherche</option>
                          <option value="nobility">Noblesse</option>
                          <option value="other">Autre</option>
                        </select>
                      </div>
                      <div class="form-group">
                        <label for="contact">Contact</label>
                        <input type="text" class="form-control" id="contact" placeholder="nakasar.192">
                      </div>
                      <div class="form-group">
                        <label for="hours">Horaires</label>
                        <input type="text" class="form-control" id="hours" placeholder="Tous les jours 21h-00h.">
                      </div>
                    </div>
                    <div class="col-md-8">
                      <div class="form-group">
                        <label for="description">Description</label>
                        <textarea class="form-control" rows="8" id="description" placeholder="Description succinte."></textarea>
                      </div>
                      <div class="form-group">
                        <label for="site">Site Web</label>
                        <input type="text" class="form-control" id="site" placeholder="http://pactedesoublies.forumactif.org/">
                      </div>
                      <div class="form-group">
                        <label for="icon">Icone</label>
                        <select class="form-control" id="icon">
                          <option value="tavern">Taverne</option>
                          <option value="guild">Guilde</option>
                          <option value="merchant">Commerce</option>
                          <option value="other">Divers</option>
                        </select>
                      </div>
                    </div>
                    <div class="col-md-12">
                      <p>
                        <button type="submit" class="btn btn-primary pull-right" data-dismiss="modal" id="perm-form-submit">Ajouter</button>
                      </p>
                    </div>
                  </div>
                </div>
              </form>
            </div>
            <div class="tab-pane fade" id="addEventLocationTabContent">
              <form id="event-form">
                <div class="well well-sm">
                  <div class="row">
                    <div class="col-md-4">
                      <div class="form-group">
                        <label for="name">Nom</label>
                        <input type="text" class="form-control :invalid" id="name" placeholder="Les Masques de Nyarlapeutêtre" required>
                      </div>
                      <div class="form-group">
                        <label for="difficulty">Difficulté</label>
                        <select class="form-control" id="difficulty" required>
                          <option value="peaceful">Promenade</option>
                          <option value="easy">Facile</option>
                          <option value="normal">Normal</option>
                          <option value="difficult">Difficile</option>
                          <option value="hardcore">Epique</option>
                        </select>
                      </div>
                      <div class="form-group">
                        <label for="type">Type</label>
                        <select multiple class="form-control" id="type" required>
                          <option value="battle">Bataille</option>
                          <option value="camp">Campement</option>
                          <option value="communitary">Communautaire</option>
                          <option value="damages">Dégâts</option>
                          <option value="danger">Zone dangereuse</option>
                          <option value="other">Autre</option>
                        </select>
                      </div>
                      <div class="form-group">
                        <label for="contact">Contact</label>
                        <input type="text" class="form-control" id="contact" placeholder="nakasar.5192" required>
                      </div>
                      <div class="form-group">
                        <label for="end_date">Date (ou date de fin)</label>
                        <input type="date" class="form-control" id="end_date" required>
                      </div>
                      <div class="form-group">
                        <label for="end_hour">Heure</label>
                        <input type="time" class="form-control" id="end_hour">
                      </div>
                    </div>
                    <div class="col-md-8">
                      <div class="form-group">
                        <label for="description">Description</label>
                        <textarea class="form-control" rows="8" id="description" placeholder="Description succinte."></textarea>
                      </div>
                      <div class="form-group">
                        <label for="site">Page de l'event</label>
                        <input type="text" class="form-control" id="site" placeholder="http://gw2rp.jdrforum.com/t9619-vendredi-28-octobre-fete-foraine">
                      </div>
                      <div class="form-group">
                        <label for="icon">Icone</label>
                        <select class="form-control" id="icon" required>
                          <option value="generic">Générique</option>
                          <option value="communitary">Communautaire</option>
                          <option value="festival">Festivité</option>
                          <option value="fight">Combat</option>
                        </select>
                      </div>
                    </div>
                    <div class="col-md-12">
                      <p>
                        <button type="submit" class="btn btn-primary pull-right" data-dismiss="modal" id="event-form-submit">Ajouter</button>
                      </p>
                    </div>
                  </div>
                </div>
              </form>
            </div>

            <div class="tab-pane fade" id="addRumourTabContent">
              <form id="rumour-form">
                <div class="well well-sm">
                  <div class="row">
                    <div class="col-md-4">
                      <div class="form-group">
                        <label for="title">Titre</label>
                        <input type="text" class="form-control" id="title" placeholder="Groupe de bandits qui traînent">
                      </div>
                      <div class="form-group">
                        <label for="contact">Contact</label>
                        <input type="text" class="form-control" id="contact" placeholder="nakasar.192">
                      </div>
                    </div>
                    <div class="col-md-8">
                      <div class="form-group">
                        <label for="text">Rumeur</label>
                        <textarea class="form-control" rows="8" id="text" placeholder="Un nouveau groupe de bandits traînerait à Shaemoor et serait responsable de récents incidents avec les villageois."></textarea>
                      </div>
                      <div class="form-group">
                        <label for="site">Site Web</label>
                        <input type="text" class="form-control" id="site" placeholder="http://pactedesoublies.forumactif.org/">
                      </div>
                    </div>
                    <div class="col-md-12">
                      <p>
                        <button type="submit" class="btn btn-primary pull-right" data-dismiss="modal" id="rumour-form-submit">Ajouter</button>
                      </p>
                    </div>
                  </div>
                </div>
              </form>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Fermer</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <div class="modal fade " tabindex="-1" role="dialog">
      <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Modal title</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Fermer">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <p id="description">Description</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="permloc-detail-modal" tabindex="-1" role="dialog" aria-labelledby="permloc-detail-modal-title" aria-hidden="true">
      <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title" id="permloc-detail-modal-title">Titre</h2>
            <button type="button" class="close" data-dismiss="modal" aria-label="Fermer">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <p id="permloc-detail-modal-description">Description</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Fermer</button>
          </div>
        </div>
      </div>
    </div>


    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.js"></script>
    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.js"></script>
    <script src="https://unpkg.com/leaflet@1.0.1/dist/leaflet.js"></script>
    <script src="app.js"></script>
    <script>
    $(function() {
      $.ajax({
        method: "GET",
        url: 'http://gw2rp-tools.ovh/api/locations',
        dataType: 'json',
        success: function(json) {
          if (json.success) {
            var locations = json.locations;
            for (var location_index in locations) {
              var permanentLocation = PermanentLocation.parse(locations[location_index]);
              addMarker(permanentLocation);
            }
          }
        }
      });

      $.ajax({
        method: "GET",
        url: 'http://gw2rp-tools.ovh/api/events',
        dataType: 'json',
        success: function(json) {
          console.log(json);
          if (json.success) {
            var events = json.events;
            for (var event_index in events) {
              var eventLocation = EventLocation.parse(events[event_index]);
              addMarker(eventLocation);
            }
          }
        }
      });

      $.ajax({
        method: "GET",
        url: 'http://gw2rp-tools.ovh/api/rumours',
        dataType: 'json',
        success: function(json) {
          console.log(json);
          if (json.success) {
            var rumours = json.rumours;
            for (var rumour_index in rumours) {
              var rumour = Rumour.parse(rumours[rumour_index]);
              addMarker(rumour);
            }
          }
        }
      });
    });

    </script>
    <script>
      var signedIn = false;
      var thisUser;

      // Retrive local storage user data if present
      if (typeof(Storage) !== "undefined") {
        var username = localStorage.getItem("user_nick_name");
        var token = localStorage.getItem("user_token");
        var id = localStorage.getItem("user_id");

        if (username) {
          $('#username').val(username);
          if (token && id) {
            // Request API to check validity of stored token.
            $.ajax({
              method: "POST",
              url: 'http://gw2rp-tools.ovh/api/me',
              data: { id: id, token: token },
              dataType: 'json',
              success: function(json) {
                if (json.success) {
                  // user is logged in.
                  signedIn = true;
                  $('#login-btn-text').text('Mon compte');
                  thisUser = new User(json.user.id, json.user.nick_name, json.user.admin, "", token);
                } else {
                  // Do nothing, token is invalid.
                }
              }
            });
          }
        }
      }

      $('#signinalert').hide();
      $('#signUp-Success').hide();
      $('#signUp-Alert').hide();

      function signOut() {
        $('#contact-form').show();
        $('#disconnect').text("Déconnecté").addClass('disabled');
        $('#disconnect').hide();
        signedIn = false;
        $('#login-btn-text').text('Se connecter');

        if (typeof(Storage) !== "undefined") {
          localStorage.removeItem("user_id");
          localStorage.removeItem("user_token");
        }
      }

      function signIn() {
        if ($('#password').val() != "" && $('#username').val() != "") {
          $.ajax({
            method: "POST",
            url: 'http://gw2rp-tools.ovh/api/login',
            data: { nick_name: $('#username').val(), password: $('#password').val()},
            dataType: 'json',
            success: onSignInResponse
          });
        } else {
          $('#signinalert').text("Vous devez indiquer votre mot de passe et votre nom d'utilisateur.");
          $('#signinalert').show();
        }
      }

      function onSignInResponse(json) {
        if (json.success) {
          $('#signinalert').hide();
          onSignIn(json);
        } else {
          $('#signinalert').text("Le nom d'utilisateur et le mot de passe ne correspondent pas.");
          $('#signinalert').show();
        }
      }

      function onSignIn(json) {
        console.log(json);
        $('#password').val('');
        $('#signUp-Success').hide();
        $('#contact-form').hide();
        $('#disconnect').text("Se déconnecter").removeClass('disabled');
        $('#disconnect').show();
        signedIn = true;
        thisUser = new User(json.user.id, json.user.nick_name, json.user.admin, json.user.email, json.token);
        $('#login-btn-text').text('Mon compte');

        // Store user data in web storage.
        if (typeof(Storage) !== "undefined") {
          localStorage.setItem("user_nick_name", thisUser.name);
          localStorage.setItem("user_id", thisUser.id);
          localStorage.setItem("user_token", thisUser.token);
        }
      }

      function displaySignUpAlert(message) {
        $('#signUp-Alert').text(message);
        $('#signUp-Alert').show();
      }

      function validateSignUp() {
        // Validate username
        var username = $("#signup-username").val();
        if(username == "") {
          displaySignUpAlert("Veuillez renseigner l'ensemble des champs.");
          return false;
        }
        if (username.length > 20) {
          displaySignUpAlert("Le nom d'utilisateur doit être inférieur à vingt caractères.");
          return false;
        }

        // Validate email
        if(!validateEmail($("#signup-email").val())) {
          displaySignUpAlert("Veuillez entrer une adresse mail valide.");
          return false;
        }

        // Validate password
        var password = $("#signup-password").val();
        if(password === "") {
          displaySignUpAlert("Veuillez renseigner l'ensemble des champs.");
          return false;
        }
        var password_regex = (/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])[0-9a-zA-Z]{8,}$/);
        if (!password_regex.test(password)) {
          displaySignUpAlert("Le mot de passe doit contenir au moins 8 caractères dont un chiffre, une majuscule et une minuscule.");
          return false;
        }
        if(password != $("#signup-password-confirm").val() ) {
          displaySignUpAlert("Les mots de passe ne correspondent pas.");
          return false;
        }

        // Validate gw2_account
        var gw2_account = $("#signup-gw2account").val();
        if (gw2_account === "") {
          displaySignUpAlert("Veuillez renseigner l'ensemble des champs.");
          return false;
        }
        var gw2_account_regex = /^([a-zA-Z]{1,}\.[0-9]{4})$/;
        if (!gw2_account_regex.test(gw2_account)) {
          displaySignUpAlert("Le nom de compte est de la forme Nakasar.5192, il se trouve en haut de votre liste de contacts en jeu.");
          return false;
        }

        return true;
      }

      function validateEmail(email) {
        var email_regex = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        return email_regex.test(email);
      }

      function signUp() {
        if(validateSignUp()) {
          console.log("validated");
          var gw2_name = $('#signup-gw2account').val().split(".")[0];
          var gw2_account_id = $('#signup-gw2account').val().split(".")[1];

          $.ajax({
            method: "POST",
            url: 'http://gw2rp-tools.ovh/api/signup',
            data: { nick_name: $('#signup-username').val(), password: $('#signup-password').val(), email: $('#signup-email').val(), gw2_account: gw2_name, gw2_id: gw2_account_id },
            dataType: 'json',
            success: onSignUpResponse
          });
        }
      }

      function onSignUpResponse(json) {
        console.log(json);
        if(json.success) {
          console.log(json);
          $('#username').val(json.user.nick_name);
          $('#signUp-Success').show();
          $('#signUp-Modal').modal('hide')
        } else {
          console.log(json);
          if (json.code == "REG-01") {
            displaySignUpAlert("Ce nom d'utilisateur est déjà enregistré.");
          } else {
            displaySignUpAlert("Impossible de créer le compte, veuillez réessayer ou contacter les développeurs (Nakasar.1592 en jeu).");
          }
        }
      }
    </script>

</body>
</html>
